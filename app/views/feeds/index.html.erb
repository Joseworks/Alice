      <%#Simple RSS does returns an array with 'title' and 'link' in some particular cases, hence URI.extract is used with .last to guarantee that only the link will be used with link_to %>

<% # encoding: UTF-8 %>



  <% today_date = DateTime.now.utc %>
  <% today_date = today_date.strftime('%A, %B %e, %Y') %>
  <% yesterday_date = 1.day.ago.midnight.utc %>
  <% yesterday_date_to_display = yesterday_date.strftime('%A, %B %e, %Y')  %>
  <% yesterday_header_counter = 0 %>

  <div class="feed-header"> <%= "#{today_date}"  %></div>

  <% if @feeds.blank? %>
    <p> There are no feeds yet. We will update soon. </p>
  <% else %>
    <br>

    <% sort_feeds_array(@feeds).each do |value| %>
      <% if value.present? %>
        <% if value[1].length > 80 %>
          <% value[1] = value[1].truncate(75, separator:' ') %>
        <% end %>

        <% if  value[3] >= Chronic.parse('yesterday midnight').utc  %>
          <% if value[0].include?"Quidnunc RE" %>
            <span class="feeds-quidnunc"><%= value[0] %></span>

            <span class="feeds-links"><%= link_to " #{value[1]}", value[2] , :target => "blank" %> </span>
          <% else %>
            <span class="feeds-source"><%=" #{value[0]}" %></span>

            <span class="feeds-links"><%= link_to " #{value[1]}", value[2] , :target => "blank" %> </span>
             <br>
          <% end %>

        <% elsif  value[3] >= Chronic.parse('two days ago midnight').utc && value[3] < Chronic.parse('yesterday midnight') &&yesterday_header_counter == 0 %>
            <div class="feed-header"> <%= "#{yesterday_date_to_display}"  %></div>

            <% yesterday_header_counter = 1 %>
          <% if value[0].include?"Quidnunc RE" %>
            <span class="feeds-quidnunc"><%= value[0] %></span>

            <span class="feeds-links"><%= link_to " #{value[1]}", value[2] , :target => "blank" %> </span>
          <% else %>
            <span class="feeds-source"><%=" #{value[0]}" %></span>

            <span class="feeds-links"><%= link_to " #{value[1]}", value[2] , :target => "blank" %> </span>
             <br>
          <% end %>

        <% else %>
          <% if value[3] > Chronic.parse('three days ago midnight').utc && value[3] < Chronic.parse('two days ago') && yesterday_header_counter == 1 %>
            <div class="feed-header"> <%= "Older Feeds"%></div>
            <% yesterday_header_counter = 2 %>
          <% end %>

          <% if value[0].include?"Quidnunc RE" %>
            <span class="feeds-quidnunc"><%= value[0] %></span>

            <span class="feeds-links"><%= link_to " #{value[1]}", value[2] , :target => "blank" %> </span>
          <% else %>
            <span class="feeds-source"><%=" #{value[0]}" %></span>

            <span class="feeds-links"><%= link_to " #{value[1]}", value[2] , :target => "blank" %> </span>
             <br>
          <% end %>

        <% end %>

      <% end %>
    <% end %>

  <% end %>
</div>

